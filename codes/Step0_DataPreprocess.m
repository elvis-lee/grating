% Script generated by Brainstorm (08-Mar-2016)

% Input files
sFiles = [];
SubjectNames = {...
    'grating_01'};
RawFiles = {...
    '/dataslow/haoli/data/grating_data/01/grating_01_tsss_mc.fif',
    '/dataslow/haoli/data/grating_data/01/grating_01-1_tsss_mc.fif',
    '/dataslow/haoli/data/grating_data/01/grating_01-2_tsss_mc.fif',
    '/dataslow/haoli/data/grating_data/01/grating_01-3_tsss_mc.fif'};

for i_RawFile = 1:4
        % Start a new report
        bst_report('Start', sFiles);

        % Process: Create link to raw file
        sFiles = bst_process('CallProcess', 'process_import_data_raw', sFiles, [], ...
            'subjectname', SubjectNames{1}, ...
            'datafile', {RawFiles{i_RawFile}, 'FIF'}, ...
            'channelreplace', 1, ...
            'channelalign', 0, ...
            'evtmode', 'value');

        % Process: Read from channel
        sFiles = bst_process('CallProcess', 'process_evt_read', sFiles, [], ...
            'stimchan', 'STI101', ...
            'trackmode', 1, ...  % Value: detect the changes of channel value
            'zero', 0);

        % Process: Detect eye blinks
        sFiles = bst_process('CallProcess', 'process_evt_detect_eog', sFiles, [], ...
            'channelname', 'MISC010', ...
            'timewindow', [], ...
            'eventname', 'blink');

        % Process: SSP EOG: blink
        sFiles = bst_process('CallProcess', 'process_ssp_eog', sFiles, [], ...
            'eventname', 'blink', ...
            'sensortypes', 'MEG', ...
            'usessp', 1, ...
            'select', 1);
        

        % Process: Import MEG/EEG: Events
        sFiles = bst_process('CallProcess', 'process_import_data_event', sFiles, [], ...
            'subjectname', SubjectNames{1}, ...
            'condition', '1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18', ...
            'eventname', '1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18', ...
            'timewindow', [], ...
            'epochtime', [-0.400, 1.000], ...
            'createcond', 1, ...
            'ignoreshort', 1, ...
            'usectfcomp', 1, ...
            'usessp', 1, ...
            'freq', [], ...
            'baseline', [-0.400, -0.001]);

        
        % Process: Detect bad trials: Peak-to-peak  MEGGRAD(0-6000) MEGMAG(0-6000)
        sFiles = bst_process('CallProcess', 'process_detectbad', sFiles, [], ...
            'timewindow', [], ...
            'meggrad', [0.01, 6000], ...
            'megmag', [0.01, 6000], ...
            'eeg', [0, 0], ...
            'eog', [0, 0], ...
            'ecg', [0, 0], ...
            'rejectmode', 2);  % Reject the entire trial

        % Process: Add time offset: -26.00ms
        sFiles = bst_process('CallProcess', 'process_timeoffset', sFiles, [], ...
        'info', [], ...
        'offset', -0.0, ...
        'overwrite', 1);

        % Save and display report
        ReportFile = bst_report('Save', sFiles);
        bst_report('Open', ReportFile);
   
end
